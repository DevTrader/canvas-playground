{"version":3,"sources":["utility/canvasState.js","scriptV2.js"],"names":["Test","data","console","log","test","bind","alert","initSmartContainerCanvas","canvas","width","height","ctx","getContext","valid","shapes","dragging","selection","dragoffx","dragoffy","anchorHit","self","getMouse","draw","addShape","clear","drawSingleAnchor","anchorHitIdentifier","addEventListener","e","preventDefault","mouse","mx","x","my","y","l","length","i","w","h","mySel","selectionColor","selectionWidth","interval","setInterval","shape","strokeStyle","lineWidth","strokeRect","element","offsetX","offsetY","offsetParent","undefined","offsetLeft","offsetTop","pageX","pageY","pi2","Math","PI","resizerRadius","beginPath","arc","closePath","fill","dx","dy","imageX","imageY","rr","imageRight","imageBottom","push","clearRect","rectShape","fillStyle","fillRect","targetCanvas","document","getElementById","myCanvas","canvasState","stage"],"mappings":"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","file":"scriptV2.f02b7b0c.map","sourceRoot":"..","sourcesContent":["class Test {\r\n\tconstructor(data) {\r\n\t\tconsole.log(data);\r\n\t\tthis.data = data;\r\n\r\n\t\tthis.test = this.test.bind(this);\r\n\t}\r\n\ttest() {\r\n\t\talert(this.data);\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tinitSmartContainerCanvas: class CanvasState {\r\n\t\tconstructor(canvas, width, height) {\r\n\t\t\t//Setup\r\n\t\t\tthis.canvas = canvas;\r\n\t\t\tthis.canvas.width = width;\r\n\t\t\tthis.canvas.height = height;\r\n\t\t\tthis.ctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\t//State\r\n\t\t\tthis.valid = false;\r\n\t\t\tthis.shapes = [];\r\n\t\t\tthis.dragging = false;\r\n\t\t\tthis.selection = null;\r\n\t\t\tthis.dragoffx = 0;\r\n\t\t\tthis.dragoffy = 0;\r\n\t\t\tthis.anchorHit = false;\r\n\r\n\t\t\t//Backup of self reference\r\n\t\t\tconst self = this;\r\n\r\n\t\t\t//binding (no class properties on parcel)\r\n\t\t\tthis.getMouse = this.getMouse.bind(this);\r\n\t\t\tthis.draw = this.draw.bind(this);\r\n\t\t\tthis.addShape = this.addShape.bind(this);\r\n\t\t\tthis.clear = this.clear.bind(this);\r\n\t\t\tthis.drawSingleAnchor = this.drawSingleAnchor.bind(this);\r\n\t\t\tthis.anchorHitIdentifier = this.anchorHitIdentifier.bind(this);\r\n\r\n\t\t\t//Prevents user from accidentally selecting (\"highlighting\") elements with mouse.\r\n\t\t\tthis.canvas.addEventListener(\"selectstart\", function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tthis.canvas.addEventListener(\r\n\t\t\t\t\"mousedown\",\r\n\t\t\t\tfunction(e) {\r\n\t\t\t\t\t//lost reference of this example\r\n\r\n\t\t\t\t\t//gets mouse position\r\n\t\t\t\t\tconst mouse = self.getMouse(e);\r\n\t\t\t\t\tconst mx = mouse.x;\r\n\t\t\t\t\tconst my = mouse.y;\r\n\t\t\t\t\tconst shapes = self.shapes;\r\n\r\n\t\t\t\t\tconst l = shapes.length;\r\n\r\n\t\t\t\t\t//Loop through created elements (shapes) and check if they are in the mouse position.\r\n\t\t\t\t\tfor (let i = l - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tconsole.log(\"[SCREENER]\", shapes[i].x + shapes[i].w >= mx);\r\n\t\t\t\t\t\t//If the mouse pos is within the element x position + its width AND element y position + its height, it is selected, prioritizes the one on \"top\" (last added element)\r\n\t\t\t\t\t\tif (shapes[i].x <= mx && shapes[i].x + shapes[i].w >= mx && shapes[i].y <= my && shapes[i].y + shapes[i].h >= my) {\r\n\t\t\t\t\t\t\t//Set state accordingly\r\n\t\t\t\t\t\t\tconst mySel = shapes[i];\r\n\t\t\t\t\t\t\tconsole.log(\"[SELECTED]\", mySel);\r\n\r\n\t\t\t\t\t\t\t// alert(JSON.stringify(mySel))\r\n\t\t\t\t\t\t\t//Create smooth dragging\r\n\t\t\t\t\t\t\tself.dragoffx = mx - mySel.x;\r\n\t\t\t\t\t\t\tself.dragoffy = my - mySel.y;\r\n\t\t\t\t\t\t\tself.dragging = true;\r\n\t\t\t\t\t\t\tself.selection = mySel;\r\n\t\t\t\t\t\t\tself.valid = false;\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//Detect anchor hit\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Where does the anchor start and end?\r\n\t\t\t\t\t * \r\n\t\t\t\t\t */\r\n\r\n\r\n\r\n\r\n\t\t\t\t\tif (self.selection && self.anchorHit) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//Deselect old selected object;\r\n\t\t\t\t\tif (self.selection && !self.anchorHit) {\r\n\t\t\t\t\t\tself.selection = null;\r\n\t\t\t\t\t\tself.valid = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\r\n\t\t\tthis.canvas.addEventListener(\r\n\t\t\t\t\"mousemove\",\r\n\t\t\t\tfunction(e) {\r\n\t\t\t\t\tif (self.dragging) {\r\n\t\t\t\t\t\tconst mouse = self.getMouse(e);\r\n\t\t\t\t\t\t//Drag elementfrom where it was clicked;\r\n\t\t\t\t\t\tconsole.log(\"[DRAGGING]\", self.dragoffx);\r\n\t\t\t\t\t\tself.selection.x = mouse.x - self.dragoffx;\r\n\t\t\t\t\t\tself.selection.y = mouse.y - self.dragoffy;\r\n\t\t\t\t\t\tself.valid = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\r\n\t\t\tthis.canvas.addEventListener(\r\n\t\t\t\t\"mouseup\",\r\n\t\t\t\tfunction(e) {\r\n\t\t\t\t\tself.dragging = false;\r\n\t\t\t\t},\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\r\n\t\t\t//Selection options and draw frequency (30ms)\r\n\t\t\t//SELECTION OPTIONS ARE NOT ADDED YET\r\n\r\n\t\t\tthis.selectionColor = \"#CC0000\";\r\n\t\t\tthis.selectionWidth = 2;\r\n\t\t\tthis.interval = 17;\r\n\t\t\tsetInterval(this.draw, this.interval);\r\n\t\t}\r\n\r\n\t\tdraw() {\r\n\t\t\t// if our state is invalid, redraw and validate!\r\n\t\t\tif (!this.valid) {\r\n\t\t\t\tconst ctx = this.canvas.getContext(\"2d\");\r\n\t\t\t\tconst shapes = this.shapes;\r\n\t\t\t\tthis.clear();\r\n\r\n\t\t\t\t// draw all shapes\r\n\t\t\t\tconst l = shapes.length;\r\n\t\t\t\tfor (var i = 0; i < l; i++) {\r\n\t\t\t\t\tconst shape = shapes[i];\r\n\t\t\t\t\t// We can skip the drawing of elements that have moved off the screen:\r\n\t\t\t\t\tif (shape.x > this.width || shape.y > this.height || shape.x + shape.w < 0 || shape.y + shape.h < 0) continue;\r\n\t\t\t\t\tshapes[i].draw(ctx);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// draw selection\r\n\t\t\t\t// right now this is just a stroke along the edge of the selected Shape\r\n\t\t\t\tif (this.selection != null) {\r\n\t\t\t\t\tctx.strokeStyle = this.selectionColor;\r\n\t\t\t\t\tctx.lineWidth = this.selectionWidth;\r\n\t\t\t\t\tconst mySel = this.selection;\r\n\r\n\r\n\t\t\t\t\t//DRAW ANCHORS (NEED HIT DETECTION)\r\n\t\t\t\t\tthis.drawSingleAnchor(mySel.x, mySel.y)\r\n\t\t\t\t\tthis.drawSingleAnchor((mySel.x + mySel.w), mySel.y)\r\n\t\t\t\t\tthis.drawSingleAnchor((mySel.x + mySel.w), (mySel.y + mySel.h))\r\n\t\t\t\t\tthis.drawSingleAnchor(mySel.x, (mySel.y + mySel.h))\r\n\r\n\t\t\t\t\tctx.strokeRect(mySel.x, mySel.y, mySel.w, mySel.h);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// ** Add stuff you want drawn on top all the time here **\r\n\r\n\t\t\t\tthis.valid = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgetMouse(e) {\r\n\t\t\tvar element = this.canvas,\r\n\t\t\t\toffsetX = 0,\r\n\t\t\t\toffsetY = 0,\r\n\t\t\t\tmx,\r\n\t\t\t\tmy;\r\n\r\n\t\t\t// Compute the total offset\r\n\t\t\tif (element.offsetParent !== undefined) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\toffsetX += element.offsetLeft;\r\n\t\t\t\t\toffsetY += element.offsetTop;\r\n\t\t\t\t} while ((element = element.offsetParent));\r\n\t\t\t}\r\n\r\n\t\t\t// Add padding and border style widths to offset\r\n\t\t\t// Also add the offsets in case there's a position:fixed bar\r\n\t\t\t// offsetX += this.stylePaddingLeft + this.styleBorderLeft + this.htmlLeft;\r\n\t\t\t// offsetY += this.stylePaddingTop + this.styleBorderTop + this.htmlTop;\r\n\r\n\t\t\tmx = e.pageX - offsetX;\r\n\t\t\tmy = e.pageY - offsetY;\r\n\t\t\tconsole.log(\"[MOUSE STUFF]\", { x: mx, y: my });\r\n\t\t\t// We return a simple javascript object (a hash) with x and y defined\r\n\t\t\treturn { x: mx, y: my };\r\n\t\t}\r\n\r\n\t\tdrawSingleAnchor(x,y){\r\n\t\t\tconst ctx = this.canvas.getContext(\"2d\");\r\n\t\t\tconst pi2=Math.PI*2;\r\n   \t \t\tconst resizerRadius=8;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x,y,resizerRadius,0,pi2,false);\r\n\t\t\tctx.closePath();\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\r\n\t\tanchorHitIdentifier(x,y){\r\n\r\n\t\t\tlet dx,dy;\r\n\t\r\n\t\t\t// top-left\r\n\t\t\tdx=x-imageX;\r\n\t\t\tdy=y-imageY;\r\n\t\t\tif(dx*dx+dy*dy<=rr){ return(0); }\r\n\t\t\t// top-right\r\n\t\t\tdx=x-imageRight;\r\n\t\t\tdy=y-imageY;\r\n\t\t\tif(dx*dx+dy*dy<=rr){ return(1); }\r\n\t\t\t// bottom-right\r\n\t\t\tdx=x-imageRight;\r\n\t\t\tdy=y-imageBottom;\r\n\t\t\tif(dx*dx+dy*dy<=rr){ return(2); }\r\n\t\t\t// bottom-left\r\n\t\t\tdx=x-imageX;\r\n\t\t\tdy=y-imageBottom;\r\n\t\t\tif(dx*dx+dy*dy<=rr){ return(3); }\r\n\t\t\treturn(-1);\r\n\t\r\n\t\t}\r\n\r\n\t\taddShape(shape) {\r\n\t\t\tthis.shapes.push(shape);\r\n\t\t\tconsole.log(this.shapes);\r\n\t\t}\r\n\r\n\t\t//this avoids ghosting, but it needs to change.\r\n\t\t//it needs to clear the \"old frames\"\r\n\t\tclear() {\r\n\t\t\tconst ctx = this.canvas.getContext(\"2d\");\r\n\t\t\t//When should this be cleared?\r\n\t\t\tctx.clearRect(0, 0, this.canvas.width, this.canvas.width);\r\n\t\t\t// this.canvas.width = window.innerWidth;\r\n\t\t\t// this.canvas.height = window.innerHeight;\r\n\t\t}\r\n\t},\r\n\trectShape: class Shape {\r\n\t\tconstructor(x, y, w, h, fill) {\r\n\t\t\tthis.x = x || 0;\r\n\t\t\tthis.y = y || 0;\r\n\t\t\tthis.w = w || 0;\r\n\t\t\tthis.h = h || 0;\r\n\t\t\tthis.fill = fill || \"#000\";\r\n\r\n\t\t\tthis.draw = this.draw.bind(this);\r\n\t\t}\r\n\t\tdraw(ctx) {\r\n\t\t\tctx.fillStyle = this.fill;\r\n\t\t\tctx.fillRect(this.x, this.y, this.w, this.h);\r\n\t\t}\r\n\t}\r\n};\r\n","import canvasState from './utility/canvasState';\r\n\r\n/**\r\n * Objective: \r\n *   1-Refactor script.js into stateful canvas pattern.\r\n *   2-Get selection and anchors working properly\r\n *   3-Initiate react structure (or utility functions)\r\n */\r\n\r\nconst targetCanvas = document.getElementById(\"canvas\")\r\n\r\nconst myCanvas = new canvasState.initSmartContainerCanvas(targetCanvas, 1500, 900)\r\n\r\nconsole.log('active')\r\n// const test = new canvasState.Test('DATA');\r\n\r\nmyCanvas.addShape(new canvasState.rectShape(530,700,240,160, 'green'))\r\nmyCanvas.addShape(new canvasState.rectShape(240,40,60,50));\r\nmyCanvas.addShape(new canvasState.rectShape(880,150,160,130, 'rgba(127, 255, 212, .5)'));\r\nmyCanvas.addShape(new canvasState.rectShape(280,10,13,400, 'red'));\r\n\r\n\r\nconsole.log('[STAGE]', stage)\r\n"]}